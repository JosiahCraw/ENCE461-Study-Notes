\begin{figure}[H]
\begin{center}
\begin{adjustbox}{width=\textwidth}
    \begin{circuitikz}
        \draw[fill=red!10] (0,0) -- (2,0) -- (2,-2) -- (0,-2) -- (0,0);
            \draw (1,-1) node[] {\textbf{ADC}};

        \draw[fill=red!10] (3,0) -- (5.5,0) -- (5.5,-2.5) -- (3,-2.5) -- (3,0);
            \draw (4.25,-0.5) node[] {\textbf{BSP}};
            \draw[fill=blue!10] (3.5,-1) -- (5,-1) -- (5,-2) -- (3.5,-2) -- (3.5,-1);
            \draw (4.25, -1.5) node[] {DRR};

        \draw[fill=red!10] (6.5,0) -- (8.5,0) -- (8.5,-2.5) -- (6.5,-2.5) -- (6.5,0);
            \draw(7.5,-1.25) node[] {\textbf{DMA}};

        \draw[fill=red!10] (19,0) -- (21,0) -- (21,-2) -- (19,-2) -- (19,0);
            \draw (20,-1) node[] {\textbf{D/A}};

        \draw[fill=red!10] (15.5,0) -- (18,0) -- (18,-2.5) -- (15.5,-2.5) -- (15.5,0);
            \draw (16.75,-0.5) node[] {\textbf{McBSP2}};
            \draw[fill=blue!10] (16,-1) -- (17.5,-1) -- (17.5,-2) -- (16,-2) -- (16,-1);
            \draw (16.75, -1.5) node[] {DXR};

        \draw[fill=red!10] (12.5,0) -- (14.5,0) -- (14.5,-2.5) -- (12.5,-2.5) -- (12.5,0);
            \draw(13.5,-1.25) node[] {\textbf{DMA2}};


        \draw[fill=gray!30] (3,-4) -- (5,-4) -- (5,-6) -- (3,-6) -- (3,-4);
            \draw[text width=2cm, text centered] (4,-5) node[] {PING IN};
        \draw[fill=gray!10] (3,-7) -- (5,-7) -- (5,-9) -- (3,-9) -- (3,-7);
            \draw[text width=2cm, text centered] (4,-8) node[] {PONG IN};
        
        \draw[fill=gray!30] (16,-4) -- (18,-4) -- (18,-6) -- (16,-6) -- (16,-4);
            \draw[text width=2cm, text centered] (17,-5) node[] {PING OUT};
        \draw[fill=gray!10] (16,-7) -- (18,-7) -- (18,-9) -- (16,-9) -- (16,-7);
            \draw[text width=2cm, text centered] (17,-8) node[] {PONG OUT};

        \draw[fill=red!10] (9,-5.5) -- (12,-5.5) -- (12,-7.5) -- (9,-7.5) -- (9,-5.5);
            \draw (10.5,-6.5) node[] {Processing};
            \draw (10.5,-5.5) node[above] {\textbf{CPU}};
        
        % Switches
        \draw[/tikz/circuitikz/bipoles/length=4cm] (1,-6.5) node[spdt] (insw0) {};
        \draw (insw0.out 1) -- ++(0.3115,0);
        \draw (insw0.out 2) -- ++(0.3115,0);

        \draw[/tikz/circuitikz/bipoles/length=4cm] (7,-6.5) node[rotate=180, spdt] (insw1) {};
        \draw (insw1.out 1) -- ++(-0.3115,0);
        \draw (insw1.out 2) -- ++(-0.3115,0);
        \draw (9,-6.5) -- (insw1.in);
        
        \draw[/tikz/circuitikz/bipoles/length=4cm] (14,-6.5) node[spdt] (outsw0) {};
        \draw (outsw0.out 1) -- ++(0.3115,0);
        \draw (outsw0.out 2) -- ++(0.3115,0);
        \draw (12,-6.5) -- (outsw0.in);

        \draw[/tikz/circuitikz/bipoles/length=4cm] (20,-6.5) node[rotate=180, spdt] (outsw1) {};
        \draw (outsw1.out 1) -- ++(-0.3115,0);
        \draw (outsw1.out 2) -- ++(-0.3115,0);

        % Arrows
        \draw[arrow] (2,-1.5) -- (3.5,-1.5);
        \draw[arrow] (5,-1.5) -- (6.5,-1.5);
        \draw (7.5,-2.5) |- (-2,-3) |- (insw0.in);
        \draw (outsw1.in) -| (23,-3) -| (13.5,-2.5);
        \draw[arrow] (14.5,-1.5) -- (16,-1.5);
        \draw[arrow] (17.5,-1.5) -- (19,-1.5);
    \end{circuitikz}
\end{adjustbox}
\end{center}
\caption{Ping Pong Buffer Configuration}
\label{fig:ping-pong}
\end{figure}
