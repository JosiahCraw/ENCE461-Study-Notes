\begin{figure}[H]
\begin{center}
    \begin{tikzpicture}
        \node[smboxes] (start) {Start};
        \node[xsmboxes, right of=start, xshift=1.5cm] (0) {};
        \node[xsmboxes, right of=0, xshift=0.75cm] (1) {};
        \node[xsmboxes, right of=1, xshift=0.75cm] (2) {};
        \node[xsmboxes, right of=2, xshift=0.75cm] (3) {};
        \node[xsmboxes, right of=3, xshift=0.75cm] (4) {};
        \node[xsmboxes, right of=4, xshift=0.75cm] (5) {};
        \node[xsmboxes, right of=5, xshift=0.75cm] (6) {};
        \node[xsmboxes, right of=6, xshift=0.75cm] (7) {\tiny RW};
        \node[xsmboxes, right of=7, xshift=0.75cm] (ACK) {\tiny ACK};
       
        
        \node[xsmboxes, below of=start, yshift=-2cm, xshift=1.5cm] (01) {};
        \node[xsmboxes, right of=01, xshift=0.75cm] (11) {};
        \node[xsmboxes, right of=11, xshift=0.75cm] (21) {};
        \node[xsmboxes, right of=21, xshift=0.75cm] (31) {};
        \node[xsmboxes, right of=31, xshift=0.75cm] (41) {};
        \node[xsmboxes, right of=41, xshift=0.75cm] (51) {};
        \node[xsmboxes, right of=51, xshift=0.75cm] (61) {};
        \node[xsmboxes, right of=61, xshift=0.75cm] (71) {};
        \node[xsmboxes, right of=71, xshift=0.75cm] (ACK1) {\tiny ACK};
        
        \node[xsmboxes, below of=01, yshift=-3cm] (02) {};
        \node[xsmboxes, right of=02, xshift=0.75cm] (12) {};
        \node[xsmboxes, right of=12, xshift=0.75cm] (22) {};
        \node[xsmboxes, right of=22, xshift=0.75cm] (32) {};
        \node[xsmboxes, right of=32, xshift=0.75cm] (42) {};
        \node[xsmboxes, right of=42, xshift=0.75cm] (52) {};
        \node[xsmboxes, right of=52, xshift=0.75cm] (62) {};
        \node[xsmboxes, right of=62, xshift=0.75cm] (72) {};
        \node[xsmboxes, right of=72, xshift=0.75cm] (ACK2) {\tiny ACK};
        \node[smboxes, right of=ACK2, xshift=1.5cm] (stop) {Stop};

        \draw (7.north east) ++(0,0.25) node[] (controlend) {};
        \draw (ACK.south west) ++(0,-0.25) node[] (ACKstart) {};
        \draw (71.north east) ++(0,0.25) node[] (addrend) {};
        \draw (ACK1.south west) ++(0,-0.25) node[] (ACK1start) {};
        \draw (02.south west) ++(0,-0.25) node[] (datastart) {};
        \draw (stop.north east) ++(0,0.25) node[] (stopend) {};
        \draw (ACK.south west) ++(0,-0.2) node[] (ACKstartlabel) {};
        \draw (ACK1.south west) ++(0,-0.2) node[] (ACK1startlabel) {};
        \draw (ACK2.north west) ++(0,0.2) node[] (ACK2startlabel) {};

        % Arrows
        \draw[arrow, blue] (start.north west) ++(0,0.25) -- (controlend);
        \draw[arrow, red] (ACK.south east) ++(0,-0.25) -- (ACKstart);
        \draw[arrow, blue] (01.north west) ++(0,0.25) -- (addrend);
        \draw[arrow, red] (ACK1.south east) ++(0,-0.25) -- (ACK1start);
        \draw[arrow, blue] (stop.north west) ++(0,0.25) -- (stopend);
        \draw[arrow, red] (ACK2.south east) ++(0,-0.25) -- (datastart);

        % Text Labels
        \draw (start) ++(-1,0) node[left] {\textbf{Control Byte}};
        \draw (01) ++(-1,0) node[left] {\textbf{Address Byte (MSB First)}};
        \draw (02) ++(-1,0) node[left] {\textbf{Data Byte (MSB First)}};

        % Byte Labels
        \draw[darrow] (0.south west) ++(0,-0.2) -- (ACKstartlabel) node[below,midway] {Slave Address};
        \draw[darrow] (01.south west) ++(0,-0.2) -- (ACK1startlabel) node[below,midway] {Memory
        Address};
        \draw[darrow] (02.north west) ++(0,0.2) -- (ACK2startlabel) node[above,midway] {Data
        Sample};

        % Key
        \draw[arrow,blue] (0,-6) -- ++(0.5, 0) node[right] {\textit{Master to Slave on SDA}};
        \draw[arrow,red] (0.5,-6.5) node[right] {\textit{Slave to Master on SDA}} -- ++(-0.5,0);

    \end{tikzpicture}
\end{center}
\caption{Serial Packet Structure}
\label{fig:serial-packet}
\end{figure}
